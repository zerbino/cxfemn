import java.util.*;

import javax.xml.bind.*;
import javax.xml.bind.util.*;
import javax.xml.validation.*;

import model.ObjectFactory;
import model.Personne;

import java.io.*;

public class CoreRequirementTest {

	protected static String SCHEMA = "personne";
	protected static String REP = "documents";
	protected static String FICHIER1 = "foo1.xml";
	protected static String FICHIER2 = "foo2.xml";

	public static Personne personne(String firstname,
			 String lastname) {
		Message msg = fabrique.createMessage();
		msg.setContenu(texte);
		msg.setLangage(langue);
		msg.setNumero(num);
		return msg;
	}

	public static void marshall(
			JAXBElement<ListeMessages> enveloppeMsgs, OutputStream out) {
		try {
			SchemaFactory factory = SchemaFactory
					.newInstance("http://www.w3.org/2001/XMLSchema");
			Schema schema = factory.newSchema(new File(REP + "/" + SCHEMA
					+ ".xsd"));
			JAXBContext jc = JAXBContext.newInstance(SCHEMA);
			Marshaller m = jc.createMarshaller();
			m.setSchema(schema);
			m.marshal(enveloppeMsgs, out);
		} catch (Exception e) {
			System.out
					.println("*** problème de traduction objet vers document : "
							+ e);
		}
	}

	public static JAXBElement<ListeMessages> unmarshall(InputStream in) {
		JAXBElement<ListeMessages> doc = null;
		try {
			SchemaFactory factory = SchemaFactory
					.newInstance("http://www.w3.org/2001/XMLSchema");
			Schema schema = factory.newSchema(new File(REP + "/" + SCHEMA
					+ ".xsd"));
			JAXBContext jc = JAXBContext.newInstance(SCHEMA);
			Unmarshaller u = jc.createUnmarshaller();
			u.setSchema(schema);
			doc = (JAXBElement<ListeMessages>) (u.unmarshal(in));
		} catch (Exception e) {
			System.out.println("*** problème de traduction document vers objet : "
					+ e);
		}
		return doc;
	}
	/** We want to illustrate here the fact that "The command
	generation and the composition of the schema compilation
	and generation commutes". 
	It means 
	EITHER generating a SOAP command from an object,
	then  generating a schema from it and getting the compilation of it back to an object instance;
	OR making the generation & compilation and then generating a SOAP command of this object
	WILL LEAD to the same result. (core requirement 4,  in 
	The Substitution Principle in an Object-Oriented
	Framework for Web Services: From Failure to Success, p8)
	
	
	**/
	public static void main(String[] args) {
		ObjectFactory fabrique = new ObjectFactory();
		Personne p=personne("Carl", "Johnson");
		
		JAXBElement<Personne> enveloppe1 = fabrique.createPersonne(p);
		enveloppe1=
		try {
			FileOutputStream out = new FileOutputStream(REP + "/" + FICHIER1);
			traduireObjetDoc(enveloppe, out);
			FileInputStream in = new FileInputStream(REP + "/" + FICHIER1);
			enveloppe = traduireDocObjet(in);
			System.out.println(enveloppe.getValue());
			out = new FileOutputStream(REP + "/" + FICHIER2);
			traduireObjetDoc(enveloppe, out);
		} catch (FileNotFoundException e) {
		}

	}
}